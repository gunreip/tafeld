window.TafeldDebug={enabled:!1,scopes:{},init(o,l){this.enabled=l==="debug"&&o.enabled,this.scopes=o.scopes||{}},scopeEnabled(o){return this.enabled?this.scopes[o]&&this.scopes[o].enabled:!1},log(o,l,s={}){this.scopeEnabled(o)&&this.consoleOutput(o,l,s)},consoleOutput(o,l,s){console.debug(`[TAFELD][${o}]`,l,s)},fromPHP(o){const{scope:l,message:s,context:e}=o;this.log(l,s,e)}};function v({model:o,countries:l,placeholder:s}){return{open:!1,openUp:!1,searchQuery:"",search:"",debounceTimer:null,model:o,placeholder:s,selected:null,selectedName:s,selectedFlag:"xx",activeIndex:-1,autoScrollTimer:null,init(){const e=l.find(t=>t.id===this.model);e&&(this.selected=e,this.selectedName=e.name_de,this.selectedFlag=e.iso_3166_2),this.preloadImages(),window.addEventListener("ui:closeAllDropdowns",t=>{t.detail?.except!=="nationality"&&(this.open=!1)})},openDropdown(){window.dispatchEvent(new CustomEvent("ui:closeAllDropdowns",{detail:{except:"nationality"}})),this.open=!0,this.computeFlip(),this.initActiveOnOpen(),this.searchQuery!==""&&(this.searchQuery="",this.search=""),this.$nextTick(()=>this.$refs.search?.focus())},closeDropdown(){this.open=!1,this.$nextTick(()=>this.$refs.button?.focus())},normalize(e){return e.toLowerCase().normalize("NFD").replace(/[̀-ͯ]/g,"").replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss")},updateSearch(e){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.search=e},120)},highlight(e){if(!this.search)return e;const t=this.normalize(this.search),r=this.normalize(e).indexOf(t);return r===-1?e:e.substring(0,r)+"<mark>"+e.substring(r,r+t.length)+"</mark>"+e.substring(r+t.length)},get filtered(){if(!this.search)return l.map(t=>({...t,highlight:t.name_de}));const e=this.normalize(this.search);return l.map(t=>{const a=this.normalize(t.name_de??""),r=(t.iso_3166_2??"").toLowerCase(),n=(t.iso_3166_3??"").toLowerCase();let i=0;return a===e&&(i+=1e3),a.startsWith(e)&&(i+=500),a.includes(e)&&(i+=100),r===e&&(i+=300),r.startsWith(e)&&(i+=200),r.includes(e)&&(i+=50),n===e&&(i+=150),n.startsWith(e)&&(i+=120),n.includes(e)&&(i+=50),{c:t,score:i}}).filter(t=>t.score>0).sort((t,a)=>a.score-t.score).map(t=>({...t.c,highlight:this.highlight(t.c.name_de)}))},computeFlip(){const e=this.$root.getBoundingClientRect(),t=window.innerHeight-e.bottom,a=260;this.openUp=t<a},initActiveOnOpen(){const e=this.filtered.findIndex(t=>t.id===this.model);this.activeIndex=e>=0?e:0,this.scrollToActive()},moveDown(){if(this.filtered.length){if(this.activeIndex===-1){this.activeIndex=0,this.scrollToActive();return}this.activeIndex<this.filtered.length-1&&this.activeIndex++,this.scrollToActive()}},moveUp(){if(this.filtered.length){if(this.activeIndex===0){this.activeIndex=-1,this.$nextTick(()=>{const e=this.$root.querySelector("[data-search-container]");e&&(e.scrollTop=0),this.$refs.search&&(this.$refs.search.focus(),this.$refs.search.select())});return}this.activeIndex>0&&this.activeIndex--,this.scrollToActive()}},selectActive(){this.activeIndex<0||this.activeIndex>=this.filtered.length||this.choose(this.filtered[this.activeIndex])},scrollToActive(){this.$nextTick(()=>{const t=this.$root.querySelectorAll("[data-country-item]")[this.activeIndex];t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})})},handleKeydown(e){const t=e.key,a=["Escape","Enter","ArrowUp","ArrowDown","Tab"];document.activeElement!==this.$refs.search&&(a.includes(t)||e.preventDefault())},clearSearch(){this.search="",this.searchQuery="",this.debounceTimer=null,this.$nextTick(()=>this.$refs.search?.focus())},stopAutoScroll(){this.autoScrollTimer&&(clearInterval(this.autoScrollTimer),this.autoScrollTimer=null)},startAutoScroll(e,t){const a=this.$root.querySelector("[data-search-container]");a&&(this.stopAutoScroll(),this.autoScrollTimer=setInterval(()=>{a.scrollTop+=e*t},16))},handleMouseMove(e){const t=this.$root.querySelector("[data-search-container]");if(!t)return;const a=t.getBoundingClientRect(),r=e.clientY-a.top,n=40,i=6;if(r<n){const c=(n-r)/n*i;this.startAutoScroll(-1,c);return}if(r>a.height-n){const d=a.height-r,c=(n-d)/n*i;this.startAutoScroll(1,c);return}this.stopAutoScroll()},handleMouseLeave(){this.stopAutoScroll()},handleWheel(e){const t=this.$root.querySelector("[data-search-container]");if(!t)return;const a=1,n=e.deltaY*1.8+(e.deltaY>0?a:-a);t.scrollTop+=n},preloadImages(){this._preloaded||(this._preloaded=!0,l.forEach(e=>{if(!e.iso_3166_2)return;const t=new Image;t.src=`/flags/${e.iso_3166_2.toLowerCase()}.svg`}))},choose(e){this.model=e.id,this.selected=e,this.selectedName=e.name_de,this.selectedFlag=e.iso_3166_2,this.search="",this.searchQuery="",this.debounceTimer=null,this.closeDropdown(),this.$dispatch("input",e.id)}}}function D({model:o,holidays:l={}}){return{open:!1,flipUp:!1,panelGlow:!1,panelGlowAnimate:!1,panelGlowStatic:!1,yearSelectOpen:!1,yearInputActive:!1,yearInputValue:"",minYear:null,maxYear:null,years:[],holidays:l,model:o,value:null,formattedValue:"",currentYear:null,currentMonth:null,days:[],weekdays:["Mo","Di","Mi","Do","Fr","Sa","So"],init(){if(this.model){const e=new Date(this.model);isNaN(e)||(this.value=e,this.formattedValue=this.formatDate(e))}this.normalizeHolidays();const s=new Date().getFullYear();this.minYear=this.minCalendarYear??s-100,this.maxYear=this.maxCalendarYear??s+30,this.generateYearList(),window.addEventListener("ui:closeAllDropdowns",e=>{e.detail?.except!=="datepicker"&&(this.open=!1,this.yearSelectOpen=!1,this.yearInputActive=!1,this.panelGlow=!1,this.panelGlowAnimate=!1,this.panelGlowStatic=!1)}),this.$watch("open",e=>{e||requestAnimationFrame(()=>{this.yearSelectOpen=!1,this.yearInputActive=!1})})},normalizeHolidays(){const s=this.holidays||{},e={};Object.entries(s).forEach(([t,a])=>{if(!Array.isArray(a))return;const r=String(t).slice(0,10);if(!r)return;const n=a.filter(i=>i&&i.display_date!==!1).map(i=>({type:i.type,name_de:i.name_de??null,confession:i.confession??null,is_school:i.type==="school",is_business:i.type==="business"}));n.length>0&&(e[r]=n)}),this.holidays=e},openDropdown(){window.dispatchEvent(new CustomEvent("ui:closeAllDropdowns",{detail:{except:"datepicker"}})),this.open=!0,this.panelGlow=!0,this.panelGlowAnimate=!0,this.panelGlowStatic=!1,setTimeout(()=>{this.panelGlowAnimate=!1,this.panelGlowStatic=!0},1650)},initCalendar(){const s=this.value?new Date(this.value):new Date;this.currentYear=s.getFullYear(),this.currentMonth=s.getMonth(),this.generateCalendar()},computeFlip(){this.$nextTick(()=>{const s=this.$root.getBoundingClientRect(),e=window.innerHeight-s.bottom,t=330;this.flipUp=e<t})},formatDate(s){const e=String(s.getDate()).padStart(2,"0"),t=String(s.getMonth()+1).padStart(2,"0"),a=s.getFullYear();return`${e}.${t}.${a}`},generateCalendar(){const s=new Date(this.currentYear,this.currentMonth,1),e=new Date(this.currentYear,this.currentMonth+1,0),t=(s.getDay()+6)%7,a=e.getDate();let r=[];for(let n=0;n<t;n++)r.push({label:"",date:null,classes:"opacity-0",key:`e-${n}`});for(let n=1;n<=a;n++){const i=new Date(this.currentYear,this.currentMonth,n),d=!this.value&&i.toDateString()===new Date().toDateString(),c=[i.getFullYear(),String(i.getMonth()+1).padStart(2,"0"),String(i.getDate()).padStart(2,"0")].join("-"),u=this.holidays[c]??[],f=u.some(h=>h.type==="holiday"),m=u.some(h=>h.type==="school"),y=u.some(h=>h.type==="business"),g=u.map(h=>h.name_de).filter(Boolean).join(`
`),w=this.value&&i.toDateString()===this.value.toDateString(),p=i.getDay(),S=["dp-day",w&&"dp-day-today",d&&"dp-day-focus",p===0&&"dp-day-sun",p===6&&"dp-day-sat",f&&"dp-day-holiday",m&&"dp-day-school",y&&"dp-day-business","dp-day-hover"].filter(Boolean).join(" ");r.push({label:n,date:i,key:`d-${n}`,classes:S,holidayName:g||null})}this.days=r},get monthLabel(){return new Date(this.currentYear,this.currentMonth).toLocaleString("de-DE",{month:"long",year:"numeric"})},get monthName(){return new Date(this.currentYear,this.currentMonth).toLocaleString("de-DE",{month:"long"})},generateYearList(){this.years=Array.from({length:this.maxYear-this.minYear+1},(s,e)=>this.minYear+e)},openYearSelect(){this.yearInputActive=!1,this.yearSelectOpen=!0},openYearInput(){this.yearSelectOpen=!1,this.yearInputActive=!0,this.yearInputValue=this.currentYear,this.$nextTick(()=>this.$refs.yearInput?.focus())},normalizeYear(s){let e=parseInt(s);return isNaN(e)?null:(s.length===2&&(e=e>=30?1900+e:2e3+e),e)},confirmYearInput(){let s=this.normalizeYear(this.yearInputValue);if(!s)return this.cancelYearInput();s=Math.min(this.maxYear,Math.max(this.minYear,s)),this.selectYear(s)},cancelYearInput(){this.yearInputActive=!1},selectYear(s){s<this.minYear||s>this.maxYear||(this.currentYear=s,this.value=new Date(this.currentYear,this.currentMonth,1),this.model=this.value.toISOString().slice(0,10),this.formattedValue=this.formatDate(this.value),this.yearSelectOpen=!1,this.yearInputActive=!1,this.generateCalendar())},prevMonth(){this.currentMonth===0?(this.currentMonth=11,this.currentYear--):this.currentMonth--,this.generateCalendar()},nextMonth(){this.currentMonth===11?(this.currentMonth=0,this.currentYear++):this.currentMonth++,this.generateCalendar()},select(s){s&&(this.value=s,this.model=s.toISOString().slice(0,10),this.formattedValue=this.formatDate(s),this.open=!1,this.panelGlow=!1,this.panelGlowAnimate=!1,this.panelGlowStatic=!1,this.yearSelectOpen=!1,this.yearInputActive=!1)},clear(){this.value=null,this.model=null,this.formattedValue="",this.open=!1,this.panelGlow=!1,this.panelGlowAnimate=!1,this.panelGlowStatic=!1,this.yearSelectOpen=!1,this.yearInputActive=!1},move(s){let e=this.value?new Date(this.value):new Date;e.setDate(e.getDate()+s),this.value=e,this.model=e.toISOString().slice(0,10),this.formattedValue=this.formatDate(e),this.currentYear=e.getFullYear(),this.currentMonth=e.getMonth(),this.generateCalendar()},confirm(){this.open=!1,this.panelGlow=!1,this.panelGlowAnimate=!1,this.panelGlowStatic=!1,this.yearSelectOpen=!1,this.yearInputActive=!1}}}window.nationalitySelect=v;window.datepickerComponent=D;document.addEventListener("livewire:init",()=>{typeof Livewire<"u"&&Livewire.on("tafeld-debug",o=>{window.TafeldDebug&&typeof window.TafeldDebug.fromPHP=="function"&&window.TafeldDebug.fromPHP(o)})});
